<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم المشرف</title>
</head>
<body>
    <h1>طلبات فتح حسابات المتاجر</h1>
    <table>
        <thead>
            <tr>
                <th>اسم المتجر</th>
                <th>اسم صاحب المتجر</th>
                <th>البريد الإلكتروني</th>
                <th>رقم الجوال</th>
                <th>الإجراءات</th>
            </tr>
        </thead>
        <tbody id="requestsTableBody">
        </tbody>
    </table>

    <script>
        async function fetchRequests() {
            try {
                const response = await fetch('http://localhost:9005/api/store-requests');
                const requests = await response.json();

                const tableBody = document.getElementById('requestsTableBody');
                tableBody.innerHTML = '';

                requests.forEach(request => {
                    const row = document.createElement('tr');

                    const storeNameCell = document.createElement('td');
                    storeNameCell.textContent = request.storeName;
                    row.appendChild(storeNameCell);

                    const ownerNameCell = document.createElement('td');
                    ownerNameCell.textContent = request.ownerName;
                    row.appendChild(ownerNameCell);

                    const emailCell = document.createElement('td');
                    emailCell.textContent = request.email;
                    row.appendChild(emailCell);

                    const phoneCell = document.createElement('td');
                    phoneCell.textContent = request.phone;
                    row.appendChild(phoneCell);

                    const actionsCell = document.createElement('td');
                    const approveButton = document.createElement('button');
                    approveButton.textContent = 'موافقة';
                    approveButton.onclick = () => handleApproval(request.id);
                    actionsCell.appendChild(approveButton);

                    const rejectButton = document.createElement('button');
                    rejectButton.textContent = 'رفض';
                    rejectButton.onclick = () => handleRejection(request.id);
                    actionsCell.appendChild(rejectButton);

                    row.appendChild(actionsCell);

                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching requests:', error);
            }
        }

        async function handleApproval(requestId) {
            try {
                const response = await fetch(`http://localhost:9005/api/store-requests/${requestId}/approve`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('تمت الموافقة على الطلب بنجاح!');
                    fetchRequests();
                } else {
                    throw new Error('Failed to approve request');
                }
            } catch (error) {
                console.error('Error approving request:', error);
                alert('حدث خطأ أثناء الموافقة على الطلب.');
            }
        }

        async function handleRejection(requestId) {
            try {
                const response = await fetch(`http://localhost:9005/api/store-requests/${requestId}/reject`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('تم رفض الطلب بنجاح!');
                    fetchRequests();
                } else {
                    throw new Error('Failed to reject request');
                }
            } catch (error) {
                console.error('Error rejecting request:', error);
                alert('حدث خطأ أثناء رفض الطلب.');
            }
        }

        // Fetch requests on page load
        fetchRequests();
    </script>
</body>
</html>
